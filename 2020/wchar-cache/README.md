# Survey for usage of PEP 393 deprecated APIs

Result: See [deprecated-use](./deprecated-use)

## 1. Chosing top 4000 package.

Get top 4000 packages from this site:

https://hugovk.github.io/top-pypi-packages/

URL: https://hugovk.github.io/top-pypi-packages/top-pypi-packages-365-days.json

file: ./top-pypi-packages-365-days.json


## 2. Download sdist packages

See this script: [download_sdist.py](./download_sdist.py)

* tar.gz: 3650
* tar.bz2: 9
* zip: 165

Other packages provide universal wheel.  They won't use C-API.


## 3. Searching deprecated APIs.

A list of deprecated APIs: [deprecated-apis](./deprecated-apis)

Use ripgrep to search:

```
$ rg -zl -f deprecated-apis *.zip *.tar.gz *.bz2 | sort > deprecated-files
```


## 4. Unacchive them

Only tar.gz files are in [deprecated-files](./deprecated-files).

```
$ cat deprecated-files | while read line; do tar xf $line; done
```

## 5. Remove files generated by Cython

Most of Cython generated files are false positive.  Just remove them.

```
$ find . -type f -print0 | xargs -0 grep -l "Generated by Cython" | xargs rm
```

## 6. grepping deprecated APIs.

```
$ rg -wn -f deprecated-apis | sort > deprecated-use
```
